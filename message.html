<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Message ‚Äî A Year With You</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #fff7f9;
      --blush: #ffd6e0;
      --ivory: #fff8f2;
      --gold: #d4a373;
      --text: #3b2e2e;
      --accent: #ff9bb3;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Poppins,system-ui,Arial;background:linear-gradient(180deg,var(--ivory),#fff7fb);color:var(--text);padding-top:60px;}
    .container{max-width:900px;margin:0 auto;padding:40px 20px}
    /* top navigation */
    .top-nav{position:fixed;top:0;left:0;right:0;display:flex;justify-content:space-around;padding:10px 0;background:var(--ivory);box-shadow:0 2px 5px rgba(0,0,0,0.05);z-index:1000;}
    .top-nav a{color:var(--accent);text-decoration:none;font-weight:600;padding:6px 10px;border-radius:8px;}
    .next-btn{background:var(--accent);color:#fff;border:none;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:600;box-shadow:0 6px 18px rgba(255,155,179,0.18)}

    /* Landing */
    .hero{min-height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column;text-align:center;background:radial-gradient(circle at 10% 10%, rgba(255,217,230,0.6), transparent 10%), linear-gradient(180deg,#fff,#fff7fb);position:relative;overflow:hidden}
    .hero h1{font-family:'Great Vibes',cursive;font-size:56px;margin:0;color:#b33b63;text-shadow:0 4px 12px rgba(179,59,99,0.08)}
    .hero p{margin:12px 0 28px;font-size:18px;color:rgba(59,46,46,0.85)}
    .btn{background:var(--accent);border:none;padding:12px 22px;border-radius:999px;font-weight:600;color:white;box-shadow:0 6px 18px rgba(255,155,179,0.18);cursor:pointer}
    .small{font-size:14px;color:rgba(59,46,46,0.7)}

    /* hearts */
    .particle{position:absolute;opacity:0.12}
    .heart{width:24px;height:24px;background:var(--accent);transform:rotate(-45deg);border-radius:4px 4px 0 0}
    .heart:before,.heart:after{content:'';position:absolute;width:24px;height:24px;background:var(--accent);border-radius:50%}
    .heart:before{top:-12px;left:0}
    .heart:after{left:12px;top:0}

    /* Gallery */
    .gallery{padding:60px 0}
    .album{display:flex;gap:18px;overflow:auto;padding-bottom:8px}
    .photo{min-width:320px;height:480px;border-radius:14px;background:#f8dfea;flex:0 0 320px;position:relative;box-shadow:0 12px 30px rgba(0,0,0,0.06);overflow:hidden}
    .photo img{width:100%;height:100%;object-fit:cover;display:block}
    .caption{position:absolute;left:16px;bottom:14px;background:rgba(255,255,255,0.76);backdrop-filter:blur(4px);padding:8px 12px;border-radius:999px;font-size:14px}

    /* Message */
    .message{padding:40px;border-radius:12px;background:linear-gradient(180deg,#fff,#fff9fb);box-shadow:0 8px 30px rgba(209,149,170,0.08);margin:40px 0;text-align:center}
    .message h2{font-family:'Great Vibes',cursive;font-size:40px;margin:6px 0}
    .message p{font-size:18px;line-height:1.5;color:rgba(59,46,46,0.85)}

    /* Ask card */
    .ask{display:flex;flex-direction:column;align-items:center;gap:18px;padding:40px;border-radius:14px;background:linear-gradient(180deg,#fff6f8,#fff);box-shadow:0 10px 40px rgba(211,160,179,0.12)}
    .ask h3{margin:0;font-size:20px}
    .choice-buttons{display:flex;gap:12px}
    .btn-ghost{background:transparent;border:2px solid var(--accent);padding:10px 16px;border-radius:12px;color:var(--accent);cursor:pointer}

    /* Form */
    form{display:flex;flex-direction:column;gap:12px;min-width:280px}
    input[type=date]{padding:10px;border-radius:8px;border:1px solid #eee}
    select{padding:10px;border-radius:8px;border:1px solid #eee}
    .note{font-size:13px;color:rgba(59,46,46,0.6)}

    /* footer */
    footer{margin:40px 0;text-align:center;color:rgba(59,46,46,0.6);font-size:13px}

    /* confirmation */
    .confetti{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none}

    @media (max-width:640px){.photo{min-width:260px;height:380px}.hero h1{font-size:44px}}
  </style>
</head>
<body>
  <nav class="top-nav">
    <a href="gallery.html">üì∑ Gallery</a>
    <a href="message.html">üíå Message</a>
    <a href="ask.html">üéÅ Wish</a>
  </nav>

  <div class="container">
    <section class="message">
      <h2>What you mean to me</h2>
      <p>Through every smile, every conversation, and all the small adventures ‚Äî you made this year brighter. I wanted to give you something that holds those moments.</p>
    </section>
    <div style="text-align:right;margin-top:18px">
      <button class="next-btn" id="nextBtn">Next ‚Üí</button>
    </div>
  </div>

  <footer>
    <div>Made with ‚ù§Ô∏è ‚Äî a little surprise for Phue's birthday (April 8)</div>
  </footer>

  <!-- optional lo-fi audio: replace src with your file path. -->
  <audio id="bgMusic" loop preload="auto">
    <source src="Lofi.mp3" type="audio/mpeg">
    <!-- If you want to use an online audio host, replace the src above with that link. -->
  </audio>
  <div style="position:fixed;left:14px;bottom:14px;display:flex;gap:8px;align-items:center">
    <button class="btn-ghost" id="musicToggle">Play Music</button>
  </div>

  <!-- confetti canvas -->
  <canvas id="confettiCanvas" class="confetti"></canvas>

  <!-- EmailJS SDK (client-side) -->
  <script src="https://cdn.emailjs.com/sdk/3.2.0/email.min.js"></script>

  <script>
    // --- UI interactions ---
    const startBtnEl = document.getElementById('startBtn');
    if(startBtnEl){
      startBtnEl.addEventListener('click', ()=>{
        const galleryEl = document.getElementById('gallery');
        if(galleryEl) galleryEl.scrollIntoView({behavior:'smooth'});
        playMusicIfAutoAllowed();
      });
    }

    // Music toggle
    const music = document.getElementById('bgMusic');
    const musicToggle = document.getElementById('musicToggle');
    let musicPlaying = false;

    // restore saved state on load
    window.addEventListener('DOMContentLoaded', () => {
      if (music) {
        const savedTime = parseFloat(localStorage.getItem('bgMusicTime'));
        if (!isNaN(savedTime)) music.currentTime = savedTime;
        const savedPlaying = localStorage.getItem('bgMusicPlaying') === 'true';
        if (savedPlaying) {
          music.play().then(() => {
            musicPlaying = true;
            if (musicToggle) musicToggle.textContent = 'Pause Music';
          }).catch(() => {});
        }
      }
    });

    if (musicToggle) {
      musicToggle.addEventListener('click', () => {
        if (musicPlaying) {
          music.pause();
          musicPlaying = false;
          musicToggle.textContent = 'Play Music';
        } else {
          music.play().catch(() => {});
          musicPlaying = true;
          musicToggle.textContent = 'Pause Music';
        }
        localStorage.setItem('bgMusicPlaying', musicPlaying);
      });
    }

    function playMusicIfAutoAllowed() {
      if (music) {
        music.play().then(() => {
          musicPlaying = true;
          if (musicToggle) musicToggle.textContent = 'Pause Music';
          localStorage.setItem('bgMusicPlaying', true);
        }).catch(() => {});
      }
    }

    if (music) {
      music.addEventListener('timeupdate', () => {
        localStorage.setItem('bgMusicTime', music.currentTime);
      });
      window.addEventListener('beforeunload', () => {
        localStorage.setItem('bgMusicTime', music.currentTime);
      });
    }

    // Ask buttons
    const yesBtn = document.getElementById('yesBtn');
    const noBtn = document.getElementById('noBtn');
    const formWrap = document.getElementById('formWrap');
    const answerField = document.getElementById('answer');

    if(yesBtn){
      yesBtn.addEventListener('click', ()=>{
        answerField.value = 'Yes ‚Äî She said YES';
        showForm();
      });
    }
    if(noBtn){
      noBtn.addEventListener('click', ()=>{
        answerField.value = 'I need a moment ‚Äî Not right now';
        showForm();
      });
    }
    function showForm(){ if(formWrap) { formWrap.style.display='flex'; formWrap.scrollIntoView({behavior:'smooth'}); } }

    // --- Email sending (EmailJS) ---
    // IMPORTANT: Sign up at https://www.emailjs.com and create a service + template.
    // Replace the placeholders below with your actual EmailJS user ID, service ID, and template ID.

    // Your EmailJS user ID (replace if needed)
    const EMAILJS_USER_ID = '777WJPe6Fu1MqYZpI';

    // Load a script dynamically and return a Promise
    function loadScript(url){
      return new Promise((resolve,reject)=>{
        const s = document.createElement('script');
        s.src = url;
        s.async = true;
        s.onload = ()=>resolve(url);
        s.onerror = ()=>reject(new Error('Failed to load '+url));
        document.head.appendChild(s);
      });
    }

    // Try primary CDN, then fallbacks
    async function ensureEmailJs(){
      if(window.emailjs) return window.emailjs;
      const candidates = [
        'https://cdn.emailjs.com/sdk/3.2.0/email.min.js',
        'https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js',
        'https://unpkg.com/emailjs-com@3/dist/email.min.js'
      ];
      for(const url of candidates){
        try{
          await loadScript(url);
          if(window.emailjs) return window.emailjs;
        }catch(e){ console.warn('EmailJS load failed for', url, e); }
      }
      return null;
    }

    // Attempt to initialize if already available; otherwise leave initialization for send-time
    (async function(){
      try{
        if(window.emailjs){
          if(EMAILJS_USER_ID && !EMAILJS_USER_ID.includes('YOUR') && !EMAILJS_USER_ID.startsWith('service_')){
            emailjs.init(EMAILJS_USER_ID);
            console.log('EmailJS initialized with user ID.');
          } else {
            console.warn('EmailJS user ID placeholder detected ‚Äî emailjs.init skipped.');
          }
        } else {
          // attempt a background load (no alerts yet)
          await ensureEmailJs();
          if(window.emailjs && EMAILJS_USER_ID && !EMAILJS_USER_ID.includes('YOUR') && !EMAILJS_USER_ID.startsWith('service_')){
            emailjs.init(EMAILJS_USER_ID);
            console.log('EmailJS loaded and initialized.');
          }
        }
      }catch(e){ console.warn('EmailJS init error:', e); }
    })();

    const askFormEl = document.getElementById('askForm');
    if(askFormEl){
      askFormEl.addEventListener('submit', async function(e){
        e.preventDefault();
        const fromName = document.getElementById('fromName').value || 'Phue (site visitor)';
        const answer = document.getElementById('answer').value || 'No answer';

        // Template parameters you'll send to EmailJS
        const templateParams = {
          to_name: 'YOUR_NAME_HERE',
          from_name: fromName,
          answer_text: answer,
          date: new Date().toLocaleString(),
        };

        // Replace these with IDs from your EmailJS account
        const SERVICE_ID = 'service_22zpu9x';
        const TEMPLATE_ID = 'template_u1syhmg';

        // Ensure EmailJS SDK is available (try to load if missing)
        if(!window.emailjs){
          console.log('EmailJS not present ‚Äî attempting to load SDK dynamically.');
          const loaded = await ensureEmailJs();
          if(!loaded || !window.emailjs){
            alert('EmailJS SDK not loaded. Check network or try opening the page from a server (not file://). See console for details.');
            console.warn('EmailJS SDK not loaded after attempts. Tried dynamic fallbacks.');
            return;
          }
        }

        // Initialize if not already done
        try{
          if(EMAILJS_USER_ID && !EMAILJS_USER_ID.includes('YOUR') && !EMAILJS_USER_ID.startsWith('service_')){
            emailjs.init(EMAILJS_USER_ID);
          }
        }catch(e){ console.warn('EmailJS init-on-send failed:', e); }
        if(!SERVICE_ID || !TEMPLATE_ID || SERVICE_ID.includes('YOUR') || TEMPLATE_ID.includes('YOUR')){
          alert('EmailJS not configured. Replace SERVICE_ID and TEMPLATE_ID in birthday.html with your EmailJS IDs.');
          console.warn('EmailJS placeholders detected ‚Äî replace SERVICE_ID and TEMPLATE_ID with real IDs from your EmailJS account.');
          return;
        }

        console.log('Sending email using EmailJS', { SERVICE_ID, TEMPLATE_ID, templateParams });

        emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams)
          .then(function(){
            showThanks();
            fireConfetti();
            console.log('EmailJS send succeeded');
          }).catch(function(err){
            console.error('Email error:', err);
            alert('Sorry ‚Äî something went wrong sending your answer. See console for details.');
          });
      });
    }

    function showThanks(){ document.getElementById('thanks').style.display='block'; }

    // --- Simple confetti ---
    function fireConfetti(){
      const canvas = document.getElementById('confettiCanvas');
      const ctx = canvas.getContext('2d');
      let w = canvas.width = window.innerWidth;
      let h = canvas.height = window.innerHeight;
      const pieces = [];
      for(let i=0;i<120;i++) pieces.push({x:Math.random()*w,y:Math.random()*-h,vy:Math.random()*4+2,angle:Math.random()*360,size:Math.random()*8+4,shape:Math.floor(Math.random()*3)});
      let t=0;
      function draw(){ ctx.clearRect(0,0,w,h); for(const p of pieces){ p.y += p.vy; p.x += Math.sin((t+p.x)/20); ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.angle*Math.PI/180); ctx.fillStyle = ['#ff9bb3','#ffd6e0','#ffd9a6'][Math.floor(Math.random()*3)]; ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size); ctx.restore(); } t+=1; requestAnimationFrame(()=>{ if(t<300) draw(); }); }
      draw();
    }

    // --- small enhancement: lazy image loading ---
    document.querySelectorAll('.photo img').forEach(img=>{ img.loading='lazy'; });

    // --- Helpful notes for you (site owner) ---
    /*
      To make this work fully:
      1) Put your real photos into the `images/` folder and update the <img src="..."> paths.
      2) Replace audio/lofi.mp3 with your chosen lo-fi track or remove the audio tag.
      3) Sign up at https://www.emailjs.com, create a service and an email template.
         - In the template map `to_name`, `from_name`, `answer_text`, `date` as shown above.
         - Replace YOUR_EMAILJS_USER_ID, YOUR_SERVICE_ID and YOUR_TEMPLATE_ID in this file.
      4) Host the site on any static host (GitHub Pages, Netlify, Vercel, or your own server).

      If you'd like, I can also:
      - Generate a ready-to-upload ZIP with images placeholders and an EmailJS guide.
      - Convert the design into a multi-page site or React component.
    */
    /*
    js userid = 777WJPe6Fu1MqYZpI
    service Id = service_22zpu9x
    template id = template_u1syhmg
    */
    // Next button (message -> ask)
    const nextBtn = document.getElementById('nextBtn');
    if(nextBtn){ nextBtn.addEventListener('click', ()=>{ window.location.href='ask.html'; }); }
  </script>
</body>
</html>